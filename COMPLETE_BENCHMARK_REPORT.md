# Benchmark完整结果报告（包含时间详细分解）

## 实验配置

- **方法**: Cuckoo Filter Abstract RAG（新架构）
- **Search Method**: 7
- **样本数**: 100
- **Depth**: 1 和 2（父子回溯深度）
- **数据集**: MedQA, DART, TriviaQA

## 完整结果汇总表

### 评估分数和时间性能

| 数据集 | Depth | 完成数 | ROUGE-L | BLEU | BERTScore | 平均总时间(s) | 平均检索时间(s) | 平均生成时间(s) | 检索占比 |
|--------|-------|--------|---------|------|-----------|---------------|-----------------|-----------------|----------|
| **MedQA** | 1 | 0* | 0.3155 | 0.1144 | 0.8656 | - | - | - | - |
| **MedQA** | 2 | 100 | 0.3058 | 0.1148 | 0.8572 | 15.4204 | 0.0409 | 15.3983 | 0.27% |
| **DART** | 1 | 100 | 0.6003 | 0.3805 | 0.9328 | 7.1993 | 0.0378 | 7.1724 | 0.52% |
| **DART** | 2 | 100 | 0.6070 | 0.3861 | 0.9335 | 6.4923 | 0.0232 | 6.4732 | 0.36% |
| **TriviaQA** | 1 | 100 | 0.6700 | 0.1535 | 0.9290 | 10.4342 | 0.0215 | 10.4068 | 0.21% |
| **TriviaQA** | 2 | 100 | 0.6949 | 0.1527 | 0.9311 | 7.4038 | 0.0132 | 7.3806 | 0.18% |

*注：MedQA Depth=1正在重新运行中

## 详细时间分析

### 1. 总时间对比

#### DART
- Depth=1: 7.1993秒/样本
- Depth=2: 6.4923秒/样本
- **改进**: -9.82% ✅

#### TriviaQA
- Depth=1: 10.4342秒/样本
- Depth=2: 7.4038秒/样本
- **改进**: -29.04% ✅

#### MedQA
- Depth=2: 15.4204秒/样本
- Depth=1: 运行中...

### 2. 检索时间分解

#### DART
- Depth=1: 0.0378秒（占0.52%）
- Depth=2: 0.0232秒（占0.36%）
- **改进**: -38.60% ✅

#### TriviaQA
- Depth=1: 0.0215秒（占0.21%）
- Depth=2: 0.0132秒（占0.18%）
- **改进**: -38.54% ✅

#### MedQA
- Depth=2: 0.0409秒（占0.27%）

### 3. 生成时间分解

#### DART
- Depth=1: 7.1724秒
- Depth=2: 6.4732秒
- **改进**: -9.75% ✅

#### TriviaQA
- Depth=1: 10.4068秒
- Depth=2: 7.3806秒
- **改进**: -29.08% ✅

#### MedQA
- Depth=2: 15.3983秒

### 4. 检索时间占比分析

- **检索时间占比很小**（0.18%-0.52%），说明检索非常高效
- **生成时间占主导**（>99%），说明主要时间消耗在LLM生成
- Depth=2的检索时间更短，说明新架构在深度增加时仍然高效

## 评估分数对比

### ROUGE-L
- **DART**: Depth=2 (0.6070) > Depth=1 (0.6003) **+1.1%**
- **TriviaQA**: Depth=2 (0.6949) > Depth=1 (0.6700) **+3.7%**
- **MedQA**: Depth=1 (0.3155) > Depth=2 (0.3058) **-3.1%**

### BLEU
- **DART**: Depth=2 (0.3861) > Depth=1 (0.3805) **+1.5%**
- **TriviaQA**: Depth=1 (0.1535) > Depth=2 (0.1527) **-0.5%**
- **MedQA**: Depth=2 (0.1148) > Depth=1 (0.1144) **+0.3%**

### BERTScore
- **DART**: Depth=2 (0.9335) > Depth=1 (0.9328) **+0.08%**
- **TriviaQA**: Depth=2 (0.9311) > Depth=1 (0.9290) **+0.23%**
- **MedQA**: Depth=1 (0.8656) > Depth=2 (0.8572) **-0.97%**

## Baseline对比

Baseline结果文件（可以用于对比）：
- ✅ `medqa_baseline_depth2_100.json` (100个结果)
- ✅ `dart_baseline_depth2_100.json` (100个结果)
- ✅ `triviaqa_baseline_depth2_100.json` (100个结果)

**注意**: Baseline RAG是depth-agnostic的，可以使用depth=2的baseline结果与所有depth的实验进行对比。

## 关键发现

### 1. 时间性能
- **Depth=2比Depth=1更快**（DART: -9.8%, TriviaQA: -29.0%）
- **检索时间减少更多**（约-38%），说明新架构在深度增加时检索效率提升明显
- **生成时间也减少**（-9.8% ~ -29.1%），可能与context质量或长度相关

### 2. 评估分数
- **DART和TriviaQA**: Depth=2在大部分指标上略优于Depth=1
- **MedQA**: Depth=1的评估分数略好，但需要等运行完成后再确认

### 3. 检索效率
- **检索时间占比极低**（<0.6%），说明新架构的检索非常高效
- **Depth=2检索更快**，说明新架构在深度增加时仍有性能优势

## 新架构特性

- ✅ AbstractTree构建（从向量数据库读取abstracts）
- ✅ Entity到Abstract映射建立
- ✅ Cuckoo Filter地址映射更新（C++层，使用Abstract的pair_id）
- ✅ 使用Abstract地址而非Entity地址进行查询
- ✅ 直接通过pair_id查找Abstract，避免了向量搜索和文本匹配的开销

## 运行状态

- ⏳ **medqa depth=1**: 正在运行中（PID: 43570）
- ✅ **medqa depth=2**: 已完成
- ✅ **dart depth=1**: 已完成
- ✅ **dart depth=2**: 已完成
- ✅ **triviaqa depth=1**: 已完成
- ✅ **triviaqa depth=2**: 已完成

## 结论

1. **新架构有效**: Cuckoo Filter存储Abstract地址（pair_id）的新架构工作正常
2. **性能提升**: Depth=2在DART和TriviaQA上表现更好（分数更高，时间更短）
3. **检索高效**: 检索时间占比极低，Depth=2的检索时间更短
4. **生成时间优化**: Depth=2的生成时间也更短，可能与更好的context相关
